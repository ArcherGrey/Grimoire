(window.webpackJsonp=window.webpackJsonp||[]).push([[263],{661:function(t,s,a){"use strict";a.r(s);var e=a(19),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"响应式原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#响应式原理"}},[t._v("#")]),t._v(" 响应式原理")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("概述")]),t._v(" "),a("p",[t._v("响应式就是在修改数据对象的时候会触发视图更新")])]),t._v(" "),a("h2",{attrs:{id:"追踪变化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#追踪变化"}},[t._v("#")]),t._v(" 追踪变化")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("原理")]),t._v(" "),a("p",[t._v("Vue 会遍历 data 选项中所有 "),a("code",[t._v("property")]),t._v("，然后使用 "),a("code",[t._v("Object.defineProperty")]),t._v(" 设置所有 "),a("code",[t._v("property")]),t._v(" 的自定义 "),a("code",[t._v("getter/setter")]),t._v("，触发 "),a("code",[t._v("setter")]),t._v(" 会通知 "),a("code",[t._v("watcher")]),t._v(" 使得相关联的组件重新渲染")])]),t._v(" "),a("img",{attrs:{src:t.$withBase("/vue_responsive_1.png"),alt:"追踪变化"}}),t._v(" "),a("h2",{attrs:{id:"检测变化的特殊情况"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检测变化的特殊情况"}},[t._v("#")]),t._v(" 检测变化的特殊情况")]),t._v(" "),a("h3",{attrs:{id:"对象"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对象"}},[t._v("#")]),t._v(" 对象")]),t._v(" "),a("p",[t._v("无法检测对象属性的添加或刪除，所以")]),t._v(" "),a("ol",[a("li",[t._v("在初始化的时候声明：")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" vm "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Vue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// `vm.a` 是响应式的")]),t._v("\n\nvm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("b "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// `vm.b` 是非响应式的")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("添加单个属性，使用 "),a("code",[t._v("$set")]),t._v(" 添加响应式属性：")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("someObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"b"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("添加多个属性，和原对象混合创建新的对象：")])]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 代替 `Object.assign(this.someObject, { a: 1, b: 2 })`")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("someObject "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("assign")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("someObject"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" b"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h3",{attrs:{id:"数组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数组"}},[t._v("#")]),t._v(" 数组")]),t._v(" "),a("p",[a("code",[t._v("Vue")]),t._v(" 不能检测以下数组的变动：")]),t._v(" "),a("ul",[a("li",[t._v("利用索引直接设置一个数组项时，例如："),a("code",[t._v("vm.items[indexOfItem] = newValue")]),t._v(" "),a("ul",[a("li",[t._v("使用 "),a("code",[t._v("$set")]),t._v(" 修改："),a("code",[t._v("Vue.set(vm.items, indexOfItem, newValue)")])]),t._v(" "),a("li",[t._v("使用 "),a("code",[t._v("splice")]),t._v("："),a("code",[t._v("vm.items.splice(indexOfItem, 1, newValue)")])])])]),t._v(" "),a("li",[t._v("修改数组的长度时，例如："),a("code",[t._v("vm.items.length = newLength")]),t._v(" "),a("ul",[a("li",[t._v("使用 "),a("code",[t._v("splice")]),t._v(": "),a("code",[t._v("vm.items.splice(newLength)")])])])])]),t._v(" "),a("h2",{attrs:{id:"异步更新队列"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#异步更新队列"}},[t._v("#")]),t._v(" 异步更新队列")]),t._v(" "),a("p",[a("code",[t._v("Vue")]),t._v(" 在更新 "),a("code",[t._v("DOM")]),t._v(" 时是异步执行的：")]),t._v(" "),a("ol",[a("li",[t._v("监听到数据变化")]),t._v(" "),a("li",[t._v("开启队列")]),t._v(" "),a("li",[t._v("缓存同一事件循环中发生的所有数据变更（同一个 "),a("code",[t._v("watcher")]),t._v(" 多次触发只会被加入到队列一次）")]),t._v(" "),a("li",[t._v("下一次事件循环 "),a("code",[t._v("tick")]),t._v(" 中刷新队列执行去重后的任务")])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注")]),t._v(" "),a("p",[a("code",[t._v("Vue")]),t._v(" 在内部对异步队列尝试使用原生的 "),a("code",[t._v("Promise.then")]),t._v("、"),a("code",[t._v("MutationObserver")]),t._v(" 和 "),a("code",[t._v("setImmediate")]),t._v("，如果执行环境不支持，则会采用 "),a("code",[t._v("setTimeout(fn, 0)")]),t._v(" 代替")])]),t._v(" "),a("p",[t._v("如果想要基于更新后的 "),a("code",[t._v("DOM")]),t._v(" 状态来做点什么，可以在数据变化之后立即使用 "),a("code",[t._v("Vue.nextTick(callback)")]),t._v("，这样回调函数将在 "),a("code",[t._v("DOM")]),t._v(" 更新完成后被调用")]),t._v(" "),a("p",[t._v("(2.6 之前的版本)\n"),a("code",[t._v("Vue.nextTick")]),t._v(" 一般情况下是微任务,在处理事件绑定的时候是宏任务(事件冒泡可能导致顺序错误)")]),t._v(" "),a("p",[t._v("最新的冒泡做了特殊处理,所有都是微任务")]),t._v(" "),a("h2",{attrs:{id:"proxy-和-defineproperty-相比优势"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#proxy-和-defineproperty-相比优势"}},[t._v("#")]),t._v(" "),a("code",[t._v("proxy")]),t._v(" 和 "),a("code",[t._v("defineproperty")]),t._v(" 相比优势")]),t._v(" "),a("p",[t._v("优势：")]),t._v(" "),a("ul",[a("li",[t._v("可以直接监听对象而非属性")]),t._v(" "),a("li",[t._v("可以直接监听数组变化")]),t._v(" "),a("li",[t._v("有 13 种拦截方法")]),t._v(" "),a("li",[t._v("返回一个新对象，对新对象操作，而 "),a("code",[t._v("defineproperty")]),t._v(" 只能遍历对象属性直接修改")]),t._v(" "),a("li",[t._v("作为新标准将会收到浏览器厂商重点持续的性能优化")])]),t._v(" "),a("p",[t._v("劣势:")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("defineproperty")]),t._v(" 兼容性好，"),a("code",[t._v("ie9")]),t._v("，无法通过 "),a("code",[t._v("polyfill")]),t._v(" 实现")])])])}),[],!1,null,null,null);s.default=n.exports}}]);