# 项目总结

## 医疗信息管理系统

项目概述：基于 ASP.NET 和 JQuery easy-ui 开发的放射科病人信息管理系统，主要用于和放射设备配套信息处理病例创建、病例编辑、拍片查看等流程

- 首屏加载时间长达 8s，病人信息列表交互卡顿，影响用户体验
  - 性能优化提升 60%，交互操作流畅度明显提升
- 编辑病例状态同步，网络连接断开问题
  - websocket 结合发布订阅模式实现病例状态同步和断线重连

思路：

场景：性能优化

结合 chrome perfomance 查看操作执行耗时分布

- JQuery
  - 尽可能使用 id 选择器
  - 在需要多次使用相同选择器的地方缓存，避免相同的对象重复查找
  - 循环调用 append 操作 dom 修改为用临时变量保存修改然后一次操作 dom
  - 直接用 JQuery 选择器多次修改样式 -> 将需要修改的样式合成一个 class 添加 class 即可
- 资源加载 页面渲染
  - 无需同步执行的请求 改为 异步执行
  - 添加资源预加载
    - 关键的脚本、字体、主要图片 preload
    - 可能会加载的资源 prefetch
  - 不太重要的脚本用异步加载 defer
  - 多个图片合成雪碧图加载减少请求次数
- 执行操作优化
  - 列表用事件委托绑定
  - 搜索添加防抖避免短时间多次请求

场景： websocket 实时通讯

- 发布订阅

  - 修改病例状态 -> 发送状态修改事件 -> 发布所有在线订阅事件
  - 断线 心跳 重连
    - 断网 服务器无法感知
    - 每隔固定时间向服务器发送心跳包 定时器
    - 重连 定时器发送重新连接请求
    - 心跳也是为了保持连接 一定时间没有消息会自动断开

1. 创建实例 new websocket
2. 初始化 实例上封装事件监听

- onclose onerror 重连
- onmessage 接收消息 发送心跳
- onopen 发送心跳

* antd 上传组件 上传图片
  - 需求：
    - 拖拽排序
      - react-dnd
    - 图片列表变化 执行上传
      - onchange 执行操作
    - 上传需要附带除了图片以外的参数
      - 不能使用默认的 action
        - antd upload 继承 rc-upload
          - rc-upload 内部实现是用 formData + ajax
      - 上传图片方式
        - 表单
          - 需要 form 组件包裹配置 麻烦
        - formData
          - 额外参数和文件数据通过 formData.append 添加
            - 如果 axios 封装默认 contenttype 不是 multipart/form-data 需要修改
          - 图片数据还可以转化 base64 可能会过大
